<div class="ap-absolute">
  <svg [attr.height]="this.flowItem.connectionsBox!.height" class="ap-overflow-visible">
    <g class="group">
      <path class="line-props" fill="transparent" [attr.d]="startingLoopLineDrawCommand" />
      <svg [attr.x]="loopingArrowHeadLeft" [attr.y]="loopingArrowHeadTop" class="ap-overflow-visible">
        <path class="line-props" fill-rule="evenodd" style="transform: rotate(-90deg);"
          d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
      </svg>
      <svg *ngIf="!insideLoopOrBranch" [attr.x]="afterLoopArrowHeadLeft" [attr.y]="afterLoopArrowHeadTop" id="test">
        <path class="line-props" fill-rule="evenodd"
          d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
      </svg>
    </g>
  </svg>
  <div class="add-button ap-cursor-pointer" (click)="addLoopItem()" [style.top]="addButtonTop"
    [style.left]="addButtonLeft" *ngIf="flowItem.firstLoopAction && !viewMode" #addButton>
    <svg-icon src="./assets/img/custom/add-button.svg" [style]="addButtonSize"></svg-icon>
  </div>
  <app-drop-zone [containerClass]="!!_flowItem.firstLoopAction? 'first-loop-drop': 'empty-loop-drop'"
    (dragEnter)="isDraggingOverFirstLoopAction=true" (dragLeave)="isDraggingOverFirstLoopAction=false"
    (dropped)="dropAtTheStartOfLoop($event)">
  </app-drop-zone>
  <div class="add-button ap-cursor-pointer afterLoopAddButton" (click)="add()" *ngIf="!viewMode"
    [style.top]="afterLoopAddButtonTop" [style.left]="afterLoopAddButtonLeft" #afterLoopAddButton>
    <svg-icon src="./assets/img/custom/add-button.svg" [style]="addButtonSize"></svg-icon>
  </div>

  <app-drop-zone containerClass="after-loop" [top]="'calc( '+afterLoopAddButtonTop +' - 25px )'"
    (dragEnter)="isDraggingOverFirstLoopAction=true" (dragLeave)="isDraggingOverFirstLoopAction=false"
    (dropped)="dropAfterLoop($event)">
  </app-drop-zone>

  <div #emptyLoopAddButton
    class="empty-loop-add-button  ap-z-50 ap-flex ap-items-center ap-justify-center ap-absolute ap-cursor-pointer"
    (mousedown)="showEmptyLoopAddButtonBoxShadow = true" (mouseup)="showEmptyLoopAddButtonBoxShadow = false"
    [class.box-shadow]="showEmptyLoopAddButtonBoxShadow" [style.top]="emptyLoopAddButtonTopOffset"
    [style.left]="emptyLoopAddButtonLeftOffset" *ngIf="!flowItem.firstLoopAction && !viewMode" (click)="addLoopItem()">
    <svg-icon src="./assets/img/custom/plus.svg" class="empty-loop-icon" [applyClass]="true"></svg-icon>
  </div>
</div>
<ng-container *ngIf="flowItem.firstLoopAction">
  <app-flow-item [flowItemData]="flowItem.firstLoopAction" [insideLoopOrBranch]="true"
    [ngStyle]="loopItemStyle()"></app-flow-item>
</ng-container>