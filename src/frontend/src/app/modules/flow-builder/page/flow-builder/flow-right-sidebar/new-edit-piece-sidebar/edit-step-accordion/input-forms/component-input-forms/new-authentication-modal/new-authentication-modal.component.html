<ng-container *ngIf="collectionId$ | async as collectionId">
  <div class="modal-header">
    <h5 class="modal-title pull-left">
      <ng-container *ngIf="!configToUpdateWithIndex; else editConfigHeader">New Authentication</ng-container>
      <ng-template #editConfigHeader>Edit {{configToUpdateWithIndex!.config.key}}</ng-template>
    </h5>
    <button type="button" class="btn-close close  pull-right" aria-label="Close" (click)="bsModalRef.hide()">
      <span aria-hidden="true" class="close-custom visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="settingsForm" class="ap-flex flex-column config-modal-form-controls-container"
      [class.ng-submitted]="submitted">
      <div>
        <label required [matTooltip]="keyTooltip" class="dashed-underline-label"
          matTooltipClass="labels-tooltip">Key</label>
        <input class="form-control" formControlName="key" type="text">
        <p @fadeInUp class="invalid-input" *ngIf="submitted && settingsForm.get('key')!.invalid">
          <ng-container
            *ngIf="submitted &&  settingsForm.get('key')!.getError('required'); else patternErrorOrAlreadyUsed">
            Key is required
          </ng-container>
          <ng-template #patternErrorOrAlreadyUsed>
            <ng-container *ngIf="settingsForm.get('key')!.getError('requiredPattern');">
              Keys can only contain letters, numbers and underscores
            </ng-container>
            <ng-container *ngIf="settingsForm.get('key')!.getError('keyUsed');">
              Keys is already used
            </ng-container>
          </ng-template>
        </p>
      </div>

      <div>
        <label class="dashed-underline-label" required [matTooltip]="clientIdTooltip"
          matTooltipClass="labels-tooltip">Client ID</label>
        <input class="form-control" formControlName="client_id" type="text">
        <p @fadeInUp class="invalid-input" *ngIf="submitted && settingsForm.get('client_id')!.invalid ">
          Client ID is required
        </p>
      </div>
      <div>
        <label class="dashed-underline-label" required [matTooltip]="clientSecretTooltip"
          matTooltipClass="labels-tooltip">Client Secret</label>
        <input class="form-control" formControlName="client_secret" type="password">
        <p @fadeInUp class="invalid-input" *ngIf="submitted && settingsForm.get('client_secret')!.invalid ">
          Client secret is required
        </p>
      </div>
      <div>
        <label class="dashed-underline-label" placement="bottom" [matTooltip]="redirectUrlTooltip"
          matTooltipClass="labels-tooltip" required>Redirect URL</label>
        <input class="form-control" formControlName="redirect_url" type="text">
      </div>
      <div>
        <app-o-auth2-connect-control [configSettings]="settingsForm.value"
          formControlName="value"></app-o-auth2-connect-control>
        <p @fadeInUp class="invalid-input" *ngIf="submitted && settingsForm.get('value')!.invalid ">
          You have to connect an account to continue
        </p>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <app-button btnColor="basic" btnStyle="basic" (buttonClicked)="bsModalRef.hide()"> Cancel
    </app-button>
    <app-button [load]="saving" (buttonClicked)="submit(collectionId)" btnColor="primary">Save
    </app-button>
  </div>

</ng-container>
